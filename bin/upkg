#!/usr/bin/env ruby

# frozen_string_literal: true

require_relative '../lib/upkg'
require 'optparse'

options = {}
OptionParser.new do |opts|
  opts.banner = 'Usage: upkg [options]'

  opts.on('-i', '--install', 'Install packages') do
    options[:install] = true
  end

  opts.on('-u', '--update', 'Update packages') do
    options[:update] = true
  end

  opts.on('--add SOURCE', 'Add package to source') do |source|
    options[:add] ||= []
    package = ARGV[0]
    ARGV.shift
    options[:add] << [source, package]
  end
end.parse!

file_path = File.expand_path('../../packages.upkg', __FILE__)
installer = Upkg::PackageInstaller.new(file_path)

if options[:add]
  options[:add].each do |args|
    installer.add_package(args[0], args[1])
  end
elsif options[:install]
  installer.install_packages
elsif options[:update]
  installer.update_packages
else
  puts I18n.t('help').yellow
end
